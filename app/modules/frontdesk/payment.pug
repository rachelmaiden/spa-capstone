doctype html
html(lang='en')
  head
    meta(charset='utf-8')
    link(rel='apple-touch-icon', sizes='76x76', href='/assets/paperDashboardPro/img/apple-icon.png')
    link(rel='icon', type='image/png', sizes='96x96', href='/assets/paperDashboardPro/img/favicon.png')
    meta(http-equiv='X-UA-Compatible', content='IE=edge,chrome=1')
    title MBAY Health Spa
    meta(property='og:site_name', content='Creative Tim')
    // Bootstrap core CSS
    link(href='/assets/paperDashboardPro/css/bootstrap.min.css', rel='stylesheet')
    // Paper Dashboard core CSS
    link(href='/assets/paperDashboardPro/css/paper-dashboard.css', rel='stylesheet')
    // CSS for Demo Purpose, don't include it in your project
    link(href='/assets/paperDashboardPro/css/demo.css', rel='stylesheet')
    // Fonts and icons
    link(href='http://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css', rel='stylesheet')
    link(href='https://fonts.googleapis.com/css?family=Muli:400,300', rel='stylesheet', type='text/css')
    link(href='/assets/paperDashboardPro/css/themify-icons.css', rel='stylesheet')
    style.
      button.hello{
        background:none!important;
        border:none; 
        padding:0!important;
        
        /*optional*/
        font-family:arial,sans-serif; /*input has OS specific font-family*/
        color:#069;
        text-decoration:underline;
        cursor:pointer;
      }
  body.sidebar-mini
    .wrapper
      .sidebar(data-active-color='spa', style='color: white')
        //
          Tip 1: you can change the color of the sidebar's background using: data-background-color="white | brown"
          Tip 2: you can change the color of the active button using the data-active-color="primary | info | success | warning | danger"
        .logo
          a.simple-text.logo-mini(href='#')
            | 
          a.simple-text.logo-normal(href='#')
            | MBAY Health Spa
        .sidebar-wrapper
          .user
            .info
              .photo
                img(src='/assets/paperDashboardPro/img/faces/face-2.jpg')
              a.collapsed(data-toggle='collapse', href='#collapseExample')
                span
                  | Front Desk
              .clearfix
          ul.nav
            li
              a(href='/frontdesk/home')
                i.ti-pencil
                p
                  | Registration
            li
              a(href='/fdReservation')
                i.ti-calendar
                p
                  | Reservation
            li.active
              a(href='/payment')
                i.ti-credit-card
                p
                  | Payment
      .main-panel
        nav.navbar.navbar-default
          .container-fluid
            .navbar-minimize
              button#minimizeSidebar.btn.btn-fill.btn-icon
                i.ti-more-alt
            .navbar-header
              button.navbar-toggle(type='button')
                span.sr-only Toggle navigation
                span.icon-bar.bar1
                span.icon-bar.bar2
                span.icon-bar.bar3
              a.navbar-brand(href='#Dashboard')
                | Payment
            .collapse.navbar-collapse
              form.navbar-form.navbar-left.navbar-search-form(role='search')
                .input-group
                  span.input-group-addon
                    i.fa.fa-search
                  input.form-control(type='text', value='', placeholder='Search/assets.')
              ul.nav.navbar-nav.navbar-right
                li
                  a.dropdown-toggle.btn-magnify(href='#stats', data-toggle='dropdown')
                    i.ti-panel
                    p Stats
                li.dropdown
                  a.dropdown-toggle.btn-rotate(href='#notifications', data-toggle='dropdown')
                    i.ti-bell
                    span.notification 5
                    p.hidden-md.hidden-lg
                      | Notifications
                      b.caret
                  ul.dropdown-menu
                    li
                      a(href='#not1') Notification 1
                    li
                      a(href='#not2') Notification 2
                    li
                      a(href='#not3') Notification 3
                    li
                      a(href='#not4') Notification 4
                    li
                      a(href='#another') Another notification
                li
                  a.btn-rotate(href='#settings')
                    i.ti-settings
                    p.hidden-md.hidden-lg
                      | Settings
        .content
          .container-fluid
            .row
              .col-md-12
                .card
                  .row
                    div
                      .card-content
                        center
                          h2 Unpaid Customers
                  .content
                    .container-fluid
                      .row
                        .col-md-12
                          p.category  
                          br
                          .card
                            .card-content
                              .toolbar
                                // Here you can write extra buttons/actions for the toolbar
                              .fresh-datatables
                                table#datatables.table.table-no-bordered.table-hover(cellspacing='0', width='100%', style='width:100%')
                                  thead
                                    tr
                                      th Name
                                      th Membership Type
                                      th Time
                                      th.disabled-sorting Actions
                                  tfoot
                                    tr
                                      th Name
                                      th Membership Type
                                      th Time
                                      th Actions
                                  tbody
                                    each notpaid in notpaids
                                      tr
                                        td= notpaid.cust_fname+" "+notpaid.cust_lname
                                        if(notpaid.cust_type==0)
                                          td Common
                                        else
                                          td Loyalty
                                        td= notpaid.walkin_start_time+" TO "+notpaid.walkin_end_time
                                        td
                                          button.btn.btn-info.btn-fill.btn-wd.checkoutButton(type='button' value=`${notpaid.walkin_id}`)
                                            span.btn-label
                                            | Checkout
                  br
                  br
                  .content
                    .container-fluid
                      .row
                        .col-md-12
                          p.category  
                          br
                          .card
                            .card-content
                              center  
                                h2 Paid Customers
                              hr
                              .toolbar
                                // Here you can write extra buttons/actions for the toolbar
                              .fresh-datatables
                                table#datatables1.table.table-no-bordered.table-hover(cellspacing='0', width='100%', style='width:100%')
                                  thead
                                    tr
                                      th Membership Type
                                      th Name
                                      th.disabled-sorting
                                      th.disabled-sorting
                                      th Services
                                  tfoot
                                    tr
                                      th Membership Type
                                      th Name
                                      th
                                      th
                                      th Services

                                  tbody
                                    each paid in paids
                                      tr
                                        if(paid.cust_type==0)
                                          td Common
                                        else
                                          td Loyalty
                                        td= paid.cust_fname+" "+paid.cust_lname
                                        td
                                        td
                                        td
                                          button.btn.btn-info.btn-fill.btn-wd.viewButton(type='button' value=`${paid.walkin_id}`)
                                            span.btn-label
                                            | View 

                  
                  
                  
                              #viewDetails.modal.fade(tabindex='-1', role='dialog')
                                .modal-dialog(role='document')
                                  .modal-content
                                    .modal-header
                                      h5.modal-title
                                        center Reservation Details
                                      button.close(type='button', data-dismiss='modal', aria-label='Close')
                                    .modal-body
                                      p reservation details
                                    .modal-footer
                                      // <button type="button" class="btn btn-secondary pull-left btn btn-info btn-fill btn-wd" ></button>
                                      button.btn.btn-secondary.btn.btn-danger.btn-fill.btn-wd(type='button', data-dismiss='modal') Close
                              
                              
                              #RegisterModal.modal.fade(tabindex='1', role='dialog' aria-labelledby='myModalLabel')
                                .modal-dialog(role='document')
                                  .modal-content
                                    .modal-header
                                      h5.modal-title
                                        center Registration
                                      button.close(type='button', data-dismiss='modal', aria-label='Close')
                                    .modal-body
                                      .row
                                        .col-md-4
                                          .form-group
                                            label.control-label Username
                                            star *
                                            input.form-control(type='text', name='username', id="username" placeholder='username\
                                            ')
                                        .col-md-4
                                          .form-group
                                            label.control-label Password
                                            star *
                                            input.form-control(type='password', name='password1', id="password" placeholder='password\
                                            ')
                                        .col-md-4
                                          .form-group
                                            label.control-label Re-enter Password
                                            star *
                                            input.form-control(type='password', name='password2', id="password2" placeholder='confim password\
                                            ')

                                      .row
                                        .col-md-5
                                            h5 Fee: 500.00
                                            h5 Perks: freebies
                                    .modal-footer
                                      button.btn.btn-secondary.btn.btn-info.btn-fill.btn-wd.pull-right.buttonRegister(type='button', data-dismiss='modal') Done
                                      button.btn.btn-secondary.btn.btn-danger.btn-fill.btn-wd.pull-left(type='button', data-dismiss='modal') Close
                              
                              
                              #checkout.modal.fade(tabindex='-1', role='dialog' aria-labelledby='myModalLabel')
                                .modal-dialog.modal-lg(role='document')
                                  .modal-content
                                    .modal-header
                                      h5.modal-title
                                        center Summary
                                      button.close(type='button', data-dismiss='modal', aria-label='Close')
                                    .modal-body
                                      div
                                        h5
                                          strong#custName
                                          br
                                          button.hello(type='' value='') Register for Loyalty Membership
                                        h5
                                          strong#Room
                                          br
                                          strong#RoomRate
                                          hr
                                      .fresh-datatables
                                        table#datatables.table.table-no-bordered.table-hover(cellspacing='0', width='100%', style='width:100%')
                                          thead
                                            tr
                                              th.disabled-sorting
                                                strong Services Availed 
                                              th.disabled-sorting Quantity
                                              th.disabled-sorting Amount
                                              th.disabled-sorting Equivalent Points
                                          tfoot
                                            tr
                                              th.disabled-sorting
                                              th
                                              th
                                              th
                                          tbody#viewServicesAvailed
                                              
                                        div
                                          h2
                                            strong#TotalPrice
                                            input.totalPrice(type='hidden' value='')
                                          h4
                                            strong#TotalPoints
                                          .row
                                            .col-md-4
                                              .form-group.has-default.bmd-form-group
                                                label Amount Received:
                                                input.form-control.amountReceived(type='number', placeholder='Amount Received' oninput="myFunction()")
                                            //- .col-md-4
                                            //-   .form-group.has-default.bmd-form-group
                                            //-     label Gift Certificate Amount:
                                            //-     input.form-control(type='number', placeholder='Gift Certificate Amount')
                                            .col-md-4
                                              .form-group.has-default.bmd-form-group
                                                label Change: 
                                                input.form-control.change(type='number', placeholder='Change' value='0')
                                            .col-md-4#appendDito
                                      .modal-footer
                                        button.btn.btn-secondary.pull-right.btn.btn-success.btn-fill.btn-wd.buttonDone(type='button') Done
                                        button.btn.btn-secondary.pull-left.btn.btn-danger.btn-fill.btn-wd(type='button', data-dismiss='modal') Cancel
                              
                              
                              
                              
                              
                              
                              
                              
                              
                              
                              
                              
                              #summary.modal.fade(tabindex='-1', role='dialog' aria-labelledby='myModalLabel')
                                .modal-dialog.modal-lg(role='document')
                                  .modal-content
                                    .modal-header
                                      h5.modal-title
                                        center Summary
                                      button.close(type='button', data-dismiss='modal', aria-label='Close')
                                    .modal-body
                                      div
                                        h5
                                          strong#CustName
                                          br
                                        h5
                                          strong#room
                                          br
                                          strong#roomRate
                                          hr
                                      .fresh-datatables
                                        table#datatables.table.table-no-bordered.table-hover(cellspacing='0', width='100%', style='width:100%')
                                          thead
                                            tr
                                              th.disabled-sorting
                                                strong Availed Services
                                              th.disabled-sorting Quantity
                                              th.disabled-sorting Amount
                                          tfoot
                                            tr
                                              th.disabled-sorting
                                              th
                                              th
                                              
                                          tbody#ViewServicesAvailed
                                              
                                        div
                                          h2
                                            strong#totalPrice
                                            input.TotalPrice(type='hidden' value='')
                                          h4
                                            strong#totalPoints
                                          //- .row
                                          //-   .col-md-4
                                          //-     .form-group.has-default.bmd-form-group
                                          //-       label Amount Received:
                                          //-       input.form-control.amountReceived(type='number', placeholder='Amount Received' oninput="myFunction()")
                                          //-   //- .col-md-4
                                          //-   //-   .form-group.has-default.bmd-form-group
                                          //-   //-     label Gift Certificate Amount:
                                          //-   //-     input.form-control(type='number', placeholder='Gift Certificate Amount')
                                          //-   .col-md-4
                                          //-     .form-group.has-default.bmd-form-group
                                          //-       label Change: 
                                          //-       input.form-control.change(type='number', placeholder='Change' value='0')
                                          //-   .col-md-4#appendDito
                                      .modal-footer
                                        center
                                          button.btn.btn-secondary.pull-left.btn.btn-danger.btn-fill.btn-wd(type='button', data-dismiss='modal') Close
                              
                              
                              
                              
                              
                              
                              .row
                                .col-md-6
                                  .card-header
                                  .card-content
                                .col-md-6
                                  .card-header
                                  .card-content
                              .row
                                .col-md-6
                                  .card-header
                                    h4.card-title
                                  .card-content
                                .col-md-6
                                  .card-header
                                  .card-content
                              .card-header
                                h4.card-title
                              .card-content
                                .row
                                  .col-md-12
                                .row
                                  .col-md-12
                                .row
    .fixed-plugin
    // Core JS Files. Extra: TouchPunch for touch library inside jquery-ui.min.js
    script(src='/assets/paperDashboardPro/js/jquery-3.1.1.min.js', type='text/javascript')
    script(src='/assets/paperDashboardPro/js/jquery-ui.min.js', type='text/javascript')
    script(src='/assets/paperDashboardPro/js/perfect-scrollbar.min.js', type='text/javascript')
    script(src='/assets/paperDashboardPro/js/bootstrap.min.js', type='text/javascript')
    // Forms Validations Plugin
    script(src='/assets/paperDashboardPro/js/jquery.validate.min.js')
    // Promise Library for SweetAlert2 working on IE
    script(src='/assets/paperDashboardPro/js/es6-promise-auto.min.js')
    // Plugin for Date Time Picker and Full Calendar Plugin
    script(src='/assets/paperDashboardPro/js/moment.min.js')
    // Date Time Picker Plugin is included in this js file
    script(src='/assets/paperDashboardPro/js/bootstrap-datetimepicker.js')
    // Select Picker Plugin
    script(src='/assets/paperDashboardPro/js/bootstrap-selectpicker.js')
    // Switch and Tags Input Plugins
    script(src='/assets/paperDashboardPro/js/bootstrap-switch-tags.js')
    // Circle Percentage-chart
    script(src='/assets/paperDashboardPro/js/jquery.easypiechart.min.js')
    // Charts Plugin
    script(src='/assets/paperDashboardPro/js/chartist.min.js')
    // Notifications Plugin
    script(src='/assets/paperDashboardPro/js/bootstrap-notify.js')
    // Sweet Alert 2 plugin
    script(src='/assets/paperDashboardPro/js/sweetalert.js')
    // Vector Map plugin
    script(src='/assets/paperDashboardPro/js/jquery-jvectormap.js')
    // Google Maps Plugin
    script(src='https://maps.googleapis.com/maps/api/js?key=AIzaSyAFPQibxeDaLIUHsC6_KqDdFaUdhrbhZ3M')
    // Wizard Plugin
    script(src='/assets/paperDashboardPro/js/jquery.bootstrap.wizard.min.js')
    // Bootstrap Table Plugin
    script(src='/assets/paperDashboardPro/js/bootstrap-table.js')
    // Plugin for DataTables.net
    script(src='/assets/paperDashboardPro/js/jquery.datatables.js')
    // Full Calendar Plugin
    script(src='/assets/paperDashboardPro/js/fullcalendar.min.js')
    // Paper Dashboard PRO Core javascript and methods for Demo purpose
    script(src='/assets/paperDashboardPro/js/paper-dashboard.js')
    // Sharrre Library
    script(src='/assets/paperDashboardPro/js/jquery.sharrre.js')
    // Paper Dashboard PRO DEMO methods, don't include it in your project!
    script(src='/assets/paperDashboardPro/js/demo.js')
    script.
        function myFunction(){
        var totalPrice = $('.totalPrice').val()
        var input = $('.amountReceived').val()
        if($('.amountReceived').val()==0)
        {
          $('.change').val(0)
        }
        else
        {
        input -= parseInt(totalPrice)

        $('.change').val(input)

        }
        }

    script.
      $(document).ready(function(){
        $('.hello').click(function(){
          var id = $(this).val()
            $('#RegisterModal').modal('show')
            $('#checkout').modal('hide')
            $('.buttonRegister').click(function(){
              $.post('/payment/register',{
                username: $('#username').val(),
                password: $('#password').val(),
                id:id})
                .done(function(data){
                  console.log(data)
                  if(data.alertDesc==0)
                    {
                      swal({
                        title: "Success",
                        icon: "success"
                      }).then(function(){
                        $('#RegisterModal').modal('hide')
                        location.reload()
                      })
                    }
                  else if(data.alertDesc==3)
                    {
                      swal({
                        title:'Not Success', 
                        text:'Username Already Exist', 
                        icon:'warning'
                        }).then(function(){
                          $('#RegisterModal').modal('show')
                        })
                    }
                  else if(data.alertDesc==1)
                    {
                      swal({
                        title: 'ERROR',
                        icon: 'error'
                      })
                    }
                })
          })
        })
      })



    script.
      $(document).ready(function(){
        $('.viewButton').click(function(){
          
          var id = $(this).val()
          $('#summary').modal('show')
          $.post('/payment/query/CheckSummary',{id:id})
          .done(data=>{
            console.log(data)
            $('#room').append(`Room: ${data.out1[0].room_name}`)
            $('#roomRate').append(`Room Rate: ${data.out1[0].room_rate}`)
            
            if(data.out2.paid_status==0)
            {
              total_amount= data.out2.walkin_total_amount + 600
              $('#totalPrice').append(`Total: ${data.out3.amount}`)
              $('.TotalPrice').val(`${data.out3.amount}`)
            }
            else if (data.out2.paid_status==0)
            {
              $('#totalPrice').append(`Total: ${data.out3.amount}`)
              $('.TotalPrice').val(`${data.out3.amount}`)
            }
            else
            {
              $('#totalPrice').append(`Total: ${data.out3.amount}`)
              $('.TotalPrice').val(`${data.out3.amount}`)
            }
            
              $('#totalPoints').append(`Total Points earned: ${data.out2.walkin_total_points}`)

            $('#CustName').append(`Customer Name: ${data.out2.cust_fname} ${data.out2.cust_mname} ${data.out2.cust_lname}`)
            for(var i=0;i<data.out1.length;i++)
            {
            $('#ViewServicesAvailed').append(`
              <tr>
              <td>${data.out1[i].service_name}</td>
              <td>${data.out1[i].service_total_quantity}</td>
              <td>${data.out1[i].service_total_price}</td>
              </tr>
            `)
            }
            $('#summary').on('hidden.bs.modal', function (){
          $('#ViewServicesAvailed').empty()
          $('#CustName').empty()
          $('#totalPrice').empty()
          $('.TotalPrice').empty()  
        })
          })
        
        
        
        //- $('.buttonDone').click(function(){
        //-   //- alert($('.amountReceived').val())
        //-   if($('.amountReceived').val()==0)
        //-     {
        //-       swal({
        //-         title: "Amount Received is 0",
        //-         icon: 'warning'
        //-       })
        //-     }
        //-   else if($('.amountReceived').val() < $('.totalPrice').val())
        //-     {
        //-       swal({
        //-         title: "Amount Received is insufficient",
        //-         icon: 'warning'
        //-       })
        //-     }
        //-   else
        //-     {
        //-   $.post('/payment/Finish',{
        //-     id:id,
        //-     amount: $('.totalPrice').val(),
        //-     cust_id: $('.hello').val() 
        //-     }).done(function(data){
        //-       if(data.alertDesc==0)
        //-         {
        //-           swal({
        //-             title: "Success",
        //-             icon: 'success'
        //-           }).then(function(){
        //-             location.reload()
        //-           })
        //-         }
        //-       else
        //-         {
        //-           swal({
        //-             title: "ERROR",
        //-             icon: 'error'
        //-           })
        //-         }
            
        //-     })
        //-     }
        //- })
        })
      
        //- $('.viewdetailsButton').click(function(){
        //-   var id = $(this).val()
        //-   $.post('/payment/query/CheckoutDets',{id:id})
        //-   .done(data=>{
        //-     $('#viewDetails').modal('show')
        //-   })
        //- })
      })


    script.
      $(document).ready(function(){
        $('.checkoutButton').click(function(){
          var id = $(this).val()
          $('#checkout').modal('show')
          $.post('/payment/query/CheckoutDets',{id:id})
          .done(data=>{
            console.log(data)
            $('#Room').append(`Room: ${data.out1[0].room_name}`)
            $('#RoomRate').append(`Room Rate: ${data.out1[0].room_rate}`)
            
            if(data.out2.paid_status==0)
            {
              total_amount= data.out2.walkin_total_amount + 600
              $('#TotalPrice').append(`Total: ${total_amount}`)
              $('.totalPrice').val(`${total_amount}`)
            }
            else if (data.out2.paid_status==0)
            {
              $('#TotalPrice').append(`Total: ${data.out2.walkin_total_amount}`)
              $('.totalPrice').val(`${data.out2.walkin_total_amount}`)
            }
            else
            {
              $('#TotalPrice').append(`Total: ${data.out2.walkin_total_amount}`)
              $('.totalPrice').val(`${data.out2.walkin_total_amount}`)
            }
            
              $('#TotalPoints').append(`Total Points to be earned: ${data.out2.walkin_total_points}`)
              $('.hello').val(data.out2.cust_id)
            if(data.out2.cust_type==0)
            {
            }
            else
            {
                $('.hello').addClass('hidden')
                $('#appendDito').append(`
                  <div class="form-group has-default bmd-form-group">
                  <label> Current Points: ${data.out2.member_points}
                    <div class="checkbox">
                      <input id="checkbox1" type="checkbox"/>
                      <label for="checkbox1">Pay using Points</label>
                    </div>
                </div>`)
            }

            $('#custName').append(`Customer Name: ${data.out2.cust_fname} ${data.out2.cust_mname} ${data.out2.cust_lname}`)
            for(var i=0;i<data.out1.length;i++)
            {
            $('#viewServicesAvailed').append(`
              <tr>
              <td>${data.out1[i].service_name}</td>
              <td>${data.out1[i].service_total_quantity}</td>
              <td>${data.out1[i].service_total_price}</td>
              <td>${data.out1[i].equivalent_points}</td>
              </tr>
            `)
            }
            $('#checkout').on('hidden.bs.modal', function (){
          $('#viewServicesAvailed').empty()
          $('#custName').empty()
          $('#TotalPrice').empty()
          $('.totalPrice').empty()  
        })
          })
        
        
        
        $('.buttonDone').click(function(){
          //- alert($('.amountReceived').val())
          if($('.amountReceived').val()==0)
            {
              swal({
                title: "Amount Received is 0",
                icon: 'warning'
              })
            }
          else if($('.amountReceived').val() < $('.totalPrice').val())
            {
              swal({
                title: "Amount Received is insufficient",
                icon: 'warning'
              })
            }
          else
            {
          $.post('/payment/Finish',{
            id:id,
            amount: $('.totalPrice').val(),
            cust_id: $('.hello').val() 
            }).done(function(data){
              if(data.alertDesc==0)
                {
                  swal({
                    title: "Success",
                    icon: 'success'
                  }).then(function(){
                    location.reload()
                  })
                }
              else
                {
                  swal({
                    title: "ERROR",
                    icon: 'error'
                  })
                }
            
            })
            }
        })
        })
      
        $('.viewdetailsButton').click(function(){
          var id = $(this).val()
          $.post('/payment/query/CheckoutDets',{id:id})
          .done(data=>{
            $('#viewDetails').modal('show')
          })
        })
      })
    script(type='text/javascript').
      $(document).ready(function(){
      demo.initOverviewDashboard();
      demo.initCirclePercentage();
      });
    script(type='text/javascript').
      $(document).ready(function() {
      $('#datatables').DataTable({
      "pagingType": "full_numbers",
      "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
      responsive: true,
      language: {
      search: "_INPUT_",
      searchPlaceholder: "Search records",
      }
      });
      });
    script.
      $(document).ready(function() {
      $('#datatables1').DataTable({
      "pagingType": "full_numbers",
      "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
      responsive: true,
      language: {
      search: "_INPUT_",
      searchPlaceholder: "Search records",
      }
      });
      });
    script(type='text/javascript').
      $(document).ready(function(){
      demo.initWizard();
      });
