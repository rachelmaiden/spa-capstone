doctype html
html(lang='en')
  head
    meta(charset='utf-8')
    link(rel='apple-touch-icon', sizes='76x76', href='/assets/assets/img/apple-icon.png')
    link(rel='icon', type='image/png', sizes='96x96', href='/assets/assets/img/favicon.png')
    meta(http-equiv='X-UA-Compatible', content='IE=edge,chrome=1')
    title Online Booking and Spa Management System
    meta(content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0', name='viewport')
    meta(name='viewport', content='width=device-width')
    // Bootstrap core CSS
    link(href='/assets/paperDashboardPro/css/bootstrap.min.css', rel='stylesheet')
    // Paper Dashboard core CSS
    link(href='/assets/paperDashboardPro/css/paper-dashboard.css?v=1.2.1', rel='stylesheet')
    // CSS for Demo Purpose, don't include it in your project
    link(href='/assets/paperDashboardPro/css/demo.css', rel='stylesheet')
    // Fonts and icons
    link(href='https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css', rel='stylesheet')
    link(href='https://fonts.googleapis.com/css?family=Muli:400,300', rel='stylesheet', type='text/css')
    link(href='/assets/paperDashboardPro/css/themify-icons.css', rel='stylesheet')
    link(href='/assets/paperDashboardPro/css/fullcalendar.css', rel='stylesheet')
    link(href='/assets/paperDashboardPro/css/scheduler.css', rel='stylesheet')
    //- style.
    //-   .pull-right .dropdown-menu:after {
    //-     left: 10em;
        
    //-       }
    //-   .pull-right .dropdown-menu {
    //-       left: 10em;
          
    //-   }
  body.sidebar-mini
    .wrapper
      .sidebar(data-background-color='white', data-active-color='spa')
        //
          Tip 1: you can change the color of the sidebar's background using: data-background-color="white | brown"
          Tip 2: you can change the color of the active button using the data-active-color="primary | info | success | warning | danger"
        .logo
          a.simple-text.logo-mini(href='https://www.creative-tim.com')
            | CT
          a.simple-text.logo-normal(href='https://www.creative-tim.com')
            | Creative Tim
        .sidebar-wrapper
          .user
            .info
              .photo
                img(src='/assets/paperDashboardPro/img/faces/face-2.jpg')
              a.collapsed(data-toggle='collapse', href='#collapseExample')
                span
                  | Front Desk
              .clearfix
          ul.nav
            li
              a(href='/frontdesk/home')
                i.ti-pencil
                p
                  | Registration
            li.active
              a(href='./fdReservation')
                i.ti-calendar
                p
                  | Reservation
      .main-panel
        nav.navbar.navbar-default
          .container-fluid
            .navbar-minimize
              button#minimizeSidebar.btn.btn-fill.btn-icon
                i.ti-more-alt
            .navbar-header
              button.navbar-toggle(type='button')
                span.sr-only Toggle navigation
                span.icon-bar.bar1
                span.icon-bar.bar2
                span.icon-bar.bar3
              a.navbar-brand(href='#calendar') Calendar
            .collapse.navbar-collapse
              form.navbar-form.navbar-left.navbar-search-form(role='search')
                .input-group
                  span.input-group-addon
                    i.fa.fa-search
                  input.form-control(type='text', value='', placeholder='Search...')
              ul.nav.navbar-nav.navbar-right
                li
                  a#date-part(style="color: black")
                li
                  a#time-part(style="color: black") 
                li
                  a.logout(style="cursor: pointer; color: black") Log Out
        .content
          .container-fluid
            .row
              //- .col-md-10.col-md-offset-1
              .card.card-calendar
                .card-content
                  input(type="hidden" value=`${customerId}` id="Id")
                  #fullCalendar
        
        //VIEW SPECIFIC SCHEDULE
        #viewDateSchedule.modal.fade(tabindex='-1', role='dialog', aria-labelledby='exampleModalLabel', aria-hidden='true')
          .modal-dialog.modal-lg(role='document')
            .modal-content
              .modal-header
                button.close(type='button', data-dismiss='modal', aria-label='Close')
                  span(aria-hidden='true') ×
                center
                  h4.modal-title
              .modal-body#viewAppend
        footer.footer
          .container-fluid
            .copyright.pull-right
              | © 
              script.
                document.write(new Date().getFullYear())
              | , made with 
              i.fa.fa-heart.heart
              |  by 
              a(href='#') Team MBAY
  // Core JS Files. Extra: TouchPunch for touch library inside jquery-ui.min.js
  script(src='/assets/paperDashboardPro/js/jquery-3.1.1.min.js', type='text/javascript')
  script(src='/assets/paperDashboardPro/js/jquery-ui.min.js', type='text/javascript')
  script(src='/assets/paperDashboardPro/js/perfect-scrollbar.min.js', type='text/javascript')
  script(src='/assets/paperDashboardPro/js/bootstrap.min.js', type='text/javascript')
  // Forms Validations Plugin
  script(src='/assets/paperDashboardPro/js/jquery.validate.min.js')
  // Promise Library for SweetAlert2 working on IE
  script(src='/assets/paperDashboardPro/js/es6-promise-auto.min.js')
  // Plugin for Date Time Picker and Full Calendar Plugin
  script(src='/assets/paperDashboardPro/js/moment.min.js')
  // Date Time Picker Plugin is included in this js file
  script(src='/assets/paperDashboardPro/js/bootstrap-datetimepicker.js')
  // Select Picker Plugin
  script(src='/assets/paperDashboardPro/js/bootstrap-selectpicker.js')
  // Switch and Tags Input Plugins
  script(src='/assets/paperDashboardPro/js/bootstrap-switch-tags.js')
  // Circle Percentage-chart
  script(src='/assets/paperDashboardPro/js/jquery.easypiechart.min.js')
  // Charts Plugin
  script(src='/assets/paperDashboardPro/js/chartist.min.js')
  // Notifications Plugin
  script(src='/assets/paperDashboardPro/js/bootstrap-notify.js')
  // Sweet Alert 2 plugin
  script(src='/assets/paperDashboardPro/js/sweetalert.js')
  // Vector Map plugin
  script(src='/assets/paperDashboardPro/js/jquery-jvectormap.js')
  // Wizard Plugin
  script(src='/assets/paperDashboardPro/js/jquery.bootstrap.wizard.min.js')
  // Bootstrap Table Plugin
  script(src='/assets/paperDashboardPro/js/bootstrap-table.js')
  // Plugin for DataTables.net
  script(src='/assets/paperDashboardPro/js/jquery.datatables.js')
  // Full Calendar Plugin
  script(src='/assets/paperDashboardPro/js/fullcalendar.js')
  // Paper Dashboard PRO Core javascript and methods for Demo purpose
  script(src='/assets/paperDashboardPro/js/paper-dashboard.js?v=1.2.1')
  // Sharrre Library
  script(src='/assets/paperDashboardPro/js/jquery.sharrre.js')
  // Paper Dashboard PRO DEMO methods, don't include it in your project!
  script(src='/assets/paperDashboardPro/js/demo.js')
  script(src='/assets/paperDashboardPro/js/scheduler.js')
  script(type='text/javascript').
    $(document).ready(function(){
        $.post('selectTime/query').done(data=>{
              console.log(data)
                for(var i=0; i<data.length;i++){
              $('#fullCalendar').fullCalendar('addResource', {
              id: data[i].room_id,
              title: data[i].room_name,
              occupancy: data[i].bed_qty
                        })
                }
              //- $('#fullCalendar').fullcalendar('renderEvent',{
              //-   id: 1,
              //-   resourceId: '9',
              //-   title: 'AAAAA',
              //-   start: '2018-08-17T13:30:00',
              //-   end: '2018-08-17T14:30:00'
              //- },true)
        })
        var customerId= $('#Id').val()
        console.log(customerId)
        var date = !{JSON.stringify(date)}
        console.log(date)
        $('#fullCalendar').fullCalendar({
          defaultView: 'agendaDay',
          nowIndicator: true,
          groupByResource: true,
          defaultDate: moment(date.date, "MM-DD-YYYY"),
          slotDuration: "00:05:00",
          minTime: "12:00",
          maxTime: "25:40",
          scrollTime: "01:00", 
          schedulerLicenseKey: 'GPL-My-Project-Is-Open-Source',
          resources: [
            
          ],
          dayClick: function(date, jsEvent, view, resource) {
            var timePicked= date.format('hh:mm A')
            var datePicked = !{JSON.stringify(date)}
            console.log(datePicked)
            swal({
              title: "You Clicked " + date.format('hh:mm A'),
              text: "Are You Sure?",
              icon: "info",
              buttons: ["Cancel","Proceed"],
              dangerMode: true
              
            }).then((proceed) => {
              if(proceed)
              {
                location.href=`/bookreservation?time=${timePicked}&date=${datePicked.date}&room=${resource.title}`
              }
              else
              {

              }
              });
            //- alert(' you clicked ' + date.format('hh:mm A') + ' from '+ resource.title);
          },
          select: function(startDate, endDate, jsEvent, view, resource) {
            //- alert('selected ' + startDate.format() + ' to ' +resource.title);
          },
          businessHours: {
            // days of week. an array of zero-based day of week integers (0=Sunday)
            dow: [ 1, 2, 3, 4, 5, 6, 7 ], // Monday - Thursday

            start: '13:00', 
            end: '01:00', 
          },
          eventRender: function(eventObj, $el) {
            $el.popover({
              title: eventObj.title,
              content: eventObj.description,
              trigger: 'hover',
              placement: 'top',
              container: 'body'
            });
          },
          eventClick: function(eventObj) {
            var dateStart= eventObj.start
            var newDate = dateStart.format('hh:mm A')
            if (eventObj.url) {
              $('#viewDateSchedule').modal('show')
              //- alert(
              //-   'Clicked ' + eventObj.title + '.\n'
              //- );

              //- window.open(eventObj.url);

              return false; // prevents browser from following link in current tab.
            } else {
              alert(newDate)
              $('#viewDateSchedule').modal('show');
              $('#viewAppend').append(`
                  <table class="table table-no-bordered table-hover" id="datatables" cellspacing="0" width="100%" style="width:100%;">
                    <thead>
                      <tr>
                        <th>Bed</th>
                        <th></th>
                        <th></th>
                        <th>Availability</th>
                        <th class="disabled-sorting">Actions</th>
                      </tr>
                    </thead>
                    <tfoot>
                      <tr>
                        <th>Bed</th>
                        <th></th>
                        <th></th>
                        <th>Availability</th>
                        <th>Actions</th>
                      </tr>
                    </tfoot>
                    <tbody>
                      <td>
                      <td>
                      <td>
                      <td>
                      <td id="BookAppend">
                      </td>
                    </tbody>
                  </table>
            `)
            $('#BookAppend').append(` <a href="/bookreservation?time=${newDate}" class="btn btn-simple btn-info" stlye="margin-right: 15px"><span class="btn-label"></span><i class="ti-calendar"></i> Book Reservation</a></li`)
            $('#viewDateSchedule').on('hidden.bs.modal', function (){
                $('#viewAppend').empty()
              });
            }
          },
          events:
          [
          {
            resourceId: '8',
            title: 'Remaining Bed(10)',
            description: 'description for Long Event',
            start: '2018-08-17T13:30:00',
            end: '2018-08-17T13:35:00'
          },
           {
            resourceId: '8',
            title: 'Remaining Bed(0)(FULL)',
            start: '2018-08-17T14:30:00',
            end: '2018-08-17T14:35:00',
            color: 'RED'
          },
          {
            resourceId: '9',
            title: 'Remaining Bed(8)',
            start: '2018-08-17T13:00:00',
            end: '2018-08-17T13:05:00'
          },
          {
            resourceId: '9',
            title: 'Remaining Bed(8)',
            start: '2018-08-17T13:30:00',
            end: '2018-08-17T13:35:00',
            color: 'green'
          },
          ]
        });
        //- $('#fullCalendar').fullCalendar('gotoDate', date.date )
    });
    
  script.
    $(document).ready(function() {
      var interval = setInterval(function() {
          var momentNow = moment();
          $('#date-part').html(momentNow.format('YYYY MMMM DD') + ' '
                              + momentNow.format('dddd')
                              .substring(0,3).toUpperCase());
          $('#time-part').html(momentNow.format('A hh:mm:ss'));
      }, 100);
      
      $('#stop-interval').on('click', function() {
          clearInterval(interval);
      });
      //- $('#calendar').val('')
      });